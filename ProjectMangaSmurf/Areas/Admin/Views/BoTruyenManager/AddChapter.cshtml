@model ProjectMangaSmurf.Models.ViewModels.CompositeViewModel
@using Microsoft.AspNetCore.Mvc.Rendering
@using ProjectMangaSmurf.Repository
@inject IboTruyenRepository boTruyenRepository
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    .preview {
        max-width: 200px;
        max-height: 350px;
        object-fit: cover;
        border: 2px solid orange;
        position: relative;
        margin: 10px;
    }

    .preview-container {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
    }

    .preview-number {
        position: absolute;
        bottom: 5px;
        right: 5px;
        background-color: orange;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: bold;
    }

    .Time {
        padding: .5rem;
        width: 100%;
        border-radius: 5px;
        border: 1px solid #888;
    }
</style>

<div class="content">
    <div class="page-header">
        <div class="page-title">
            <h2>UPLOAD NEW CHAPTER                 <i class="fa-solid fa-book-medical"></i></h2>
            <h3>Bộ Truyện @Model.AddChapterViewModel.IdBo</h3>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <form asp-area="Admin" asp-action="AddChapter" method="post" enctype="multipart/form-data" class="row">
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Comic</label>
                        <input asp-for="AddChapterViewModel.IdBo" type="text" readonly class="form-control">
                        <input asp-for="Chapter.IdBo" type="hidden" value="@Model.AddChapterViewModel.IdBo">
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Chapter No.</label>
                        <input asp-for="AddChapterViewModel.SttChap" type="text" readonly class="form-control">
                        <input asp-for="Chapter.SttChap" type="hidden" value="@Model.AddChapterViewModel.SttChap">
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label asp-for="Chapter.TicketCost">Ticket Cost</label>
                        <input asp-for="Chapter.TicketCost" type="text" placeholder="1, 2, 3, ..." class="form-control" required>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label asp-for="Chapter.TenChap">Chapter Tilte</label>
                        <input asp-for="Chapter.TenChap" type="text" placeholder="Example ..." class="form-control" required>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label asp-for="Chapter.ThoiGian">Uploaded Time</label>
                        <input asp-for="Chapter.ThoiGian" type="datetime-local" class="form-control Time" value="@DateTimeOffset.Now.ToOffset(TimeSpan.FromHours(7)).ToString("yyyy-MM-ddTHH:mm:ss.fffK")" required>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label asp-for="Chapter.TtPemium">Premium Stats</label>
                        <select asp-for="Chapter.TtPemium" class="form-control select" required>
                            <option>true</option>
                            <option>false</option>
                        </select>
                    </div>
                </div>

                <div class="col-lg-12">
                    <div class="form-group">
                        <input asp-for="Chapter.TkLuotxem" type="text" value="0" hidden>
                        <input asp-for="Chapter.Active" type="text" value="true" hidden>
                        <input asp-for="Chapter.TrangThai" type="text" value="1" hidden>
                    </div>
                </div>

                <div class="col-lg-12">
                    <div class="form-group">
                        <div class="image-upload d-flex flex-column justify-content-center align-center">
                            <input type="file" name="images" class="imgInput" data-target="preview-container" multiple>
                            <div id="preview-container" class="preview-container"></div>
                            <div class="image-uploads">
                                <img src="~/img/icons/upload.svg" alt="img">
                                <h4>Chọn List Ảnh Chapter</h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div asp-validation-summary="ModelOnly" class="col-lg-12 p-4 text-danger" style="font-size:20px; font-weight:600"></div>
                <div class="col-lg-12">
                    <button type="submit" class="btn btn-submit me-2">Submit</button>
                    <button type="button" class="btn btn-cancel" onclick="window.history.back();">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function readURL(input, targetID) {
        if (input.files) {
            $('#' + targetID).empty(); // Clear previous previews
            Array.from(input.files).forEach((file, index) => {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var previewHtml = `
                            <div class="preview-wrapper" style="position: relative;">
                                <img class="preview" src="${e.target.result}" alt="your image" />
                                <span class="preview-number">${index + 1}</span>
                            </div>`;
                    $('#' + targetID).append(previewHtml);
                }
                reader.readAsDataURL(file);
            });
        }
    }

    $(document).ready(function () {
        $(".imgInput").change(function () {
            var targetID = $(this).data('target');
            readURL(this, targetID);
        });
    });
</script>

<script>
    var message = "@TempData["Message"]";
    if (message) {
        var confirmed = confirm(message);
        if (confirmed) {
            // Action if confirmed
        } else {
            window.location.href = "/Admin";
        }
    }
</script>
